@model COACHME.MODEL.CUSTOM_MODELS.CONTAINER_MODEL
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_TeacherLayout.cshtml";
}
<div class="m-content">
    @if (TempData["Message"] != null)
    {
        <p style="text-align:center" class="text-success"> @TempData["Message"].ToString() </p>
    }
    <div class="m-portlet ">
        <div class="m-portlet__body  m-portlet__body--no-padding">
            <div class="row m-row--no-padding m-row--col-separator-xl">
                <div class="col-md-12 col-lg-6 col-xl-3">

                    <!--begin::Total Profit-->
                    <div class="m-widget24">
                        <div class="m-widget24__item">
                            <h4 class="m-widget24__title">
                                Total Income
                            </h4><br>
                            <span class="m-widget24__desc">
                                All Teacher
                            </span>
                            <span class="m-widget24__stats m--font-brand">
                                @Url.Content(@Model.TotalProfit.ToString())฿
                            </span>
                            <div class="m--space-10"></div>
                            <div class="progress m-progress--sm">
                                <div class="progress-bar m--bg-brand" role="progressbar" style="width: 78%;" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <span class="m-widget24__change">
                                Change
                            </span>
                            <span class="m-widget24__number">
                                78%
                            </span>
                        </div>
                    </div>

                    <!--end::Total Profit-->
                </div>
                <div class="col-md-12 col-lg-6 col-xl-3">

                    <!--begin::New Feedbacks-->
                    <div class="m-widget24">
                        <div class="m-widget24__item">
                            <h4 class="m-widget24__title">
                                New Teacher
                            </h4><br>
                            <span class="m-widget24__desc">
                                (This month)
                            </span>
                            <span class="m-widget24__stats m--font-info">
                                @Url.Content(@Model.CountTeacherByMonth.ToString())
                            </span>
                            <div class="m--space-10"></div>
                            <div class="progress m-progress--sm">
                                <div class="progress-bar m--bg-info" role="progressbar" style="width: 84%;" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <span class="m-widget24__change">
                                Change
                            </span>
                            <span class="m-widget24__number">
                                84%
                            </span>
                        </div>
                    </div>

                    <!--end::New Feedbacks-->
                </div>
                <div class="col-md-12 col-lg-6 col-xl-3">

                    <!--begin::New Orders-->
                    <div class="m-widget24">
                        <div class="m-widget24__item">
                            <h4 class="m-widget24__title">
                                Total Teacher
                            </h4><br>
                            <span class="m-widget24__desc">

                            </span>
                            <span class="m-widget24__stats m--font-danger">
                                @Url.Content(@Model.CountAllTeacher.ToString())
                            </span>
                            <div class="m--space-10"></div>
                            <div class="progress m-progress--sm">
                                <div class="progress-bar m--bg-danger" role="progressbar" style="width: 69%;" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <span class="m-widget24__change">
                                Change
                            </span>
                            <span class="m-widget24__number">
                                69%
                            </span>
                        </div>
                    </div>

                    <!--end::New Orders-->
                </div>
                <div class="col-md-12 col-lg-6 col-xl-3">

                    <!--begin::New Users-->
                    <div class="m-widget24">
                        <div class="m-widget24__item">
                            <h4 class="m-widget24__title">
                                Total Student
                            </h4><br>
                            <span class="m-widget24__desc">

                            </span>
                            <span class="m-widget24__stats m--font-success">
                                @Url.Content(@Model.CountAllStudent.ToString())
                            </span>
                            <div class="m--space-10"></div>
                            <div class="progress m-progress--sm">
                                <div class="progress-bar m--bg-success" role="progressbar" style="width: 90%;" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <span class="m-widget24__change">
                                Change
                            </span>
                            <span class="m-widget24__number">
                                90%
                            </span>
                        </div>
                    </div>

                    <!--end::New Users-->
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-12">

        <!--begin:: Widgets/User Progress -->
        <div class="m-portlet m-portlet--full-height ">
            <div class="m-portlet__head">
                <div class="m-portlet__head-caption">
                    <div class="m-portlet__head-title">
                        <h3 class="m-portlet__head-text">
                            รายชื่อคนซื้อ แพ็คเกจ
                        </h3>
                    </div>
                </div> 
            </div>
            <div class="m-portlet__body">
                <div class="tab-content">
                    <div class="tab-pane active" id="m_widget4_tab1_content">
                        <div class="m-widget4 m-widget4--progress">
                            @foreach (var item in Model.LIST_MEMBER_PACKAGE)
                            {
                                <div class="m-widget4__item">
                                    <div class="m-widget4__img m-widget4__img--pic">
                                        @*<img src="~/Content/images/Blank-Profile.jpg" alt="">*@
                                        @if (item.MEMBERS.PROFILE_IMG_URL != null)
                                        {
                                            <img src="../@item.MEMBERS.PROFILE_IMG_URL" alt="">
                                        }
                                        else
                                        {
                                            <img src="~/Content/images/Blank-Profile.jpg" alt="">
                                        }

                                    </div>
                                    <div class="m-widget4__info">
                                        <span class="m-widget4__title">
                                            @item.MEMBERS.FULLNAME
                                        </span><br>
                                        <span class="m-widget4__sub">
                                            @item.MEMBERS.ABOUT
                                        </span>
                                    </div>
                                    <div class="m-widget4__progress">
                                        <div class="m-widget4__progress-wrapper">
                                            <span class="m-widget17__progress-number">
                                              Purchase Date :  @if (item.EFFECTIVE_DATE.Value != null)
                                                {
                                                    @item.EFFECTIVE_DATE.Value.ToString("yyyy-MM-dd");
                                                }
                                                
                                            </span>
                                            <span class="m-widget17__progress-label">Expiry Date : @item.EXPIRE_DATE.Value.ToString("yyyy-MM-dd")</span>
                                            <div class="progress m-progress--sm">
                                                <div class="progress-bar bg-danger" role="progressbar" style="width: 99%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="99"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="m-widget4__ext">
                                        @if (DateTime.Now.Date > item.EXPIRE_DATE.Value.Date)
                                        {
                                            <a href="#" class="btn m-btn--pill    btn-danger active">Expired</a>
                                        }
                                        else
                                        {
                                            if (item.STATUS == "DRAFT")
                                            {
                                                <button type="button" class="btn m-btn--pill" id="@item.AUTO_ID" onclick="ConfirmPurchase(this.id)"
                                                        btn-secondary active" data-toggle="modal" data-target="#m_modal_5">
                                                    Pending
                                                </button>

                                            }
                                            else if (item.STATUS == "DRAFT")
                                            {
                                                <a href="" class="btn m-btn--pill    btn-success m-btn m-btn--custom">Activated</a>
                                            }
                                        }
                                    </div>
                                </div>
                            }

                        </div>
                    </div>

                </div>
            </div>
        </div>
        <!--end:: Widgets/User Progress -->
    </div>

    <!--begin::Modal-->
    @using (Html.BeginForm("manage", "admin", FormMethod.Post))
    {
        <div class="modal fade" id="m_modal_5" tabindex="-1" role="dialog" aria-labelledby="popupactivate" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="popupactivate">Confirm purchase package</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>

                    <div class="modal-body">
                        <form>
                            @Html.TextBoxFor(m => m.MEMBER_PACKAGE.AUTO_ID, new { @id = "cAUTO_ID", @name = "AUTO_ID", @class = "form-control m-input", @style = "display: none;" })
                             
                            <div class="form-group m-form__group row">
                                <label for="message-text" class="col-4 col-form-label">Package Name:</label>
                                <div class="col-8">
                                    @Html.TextBoxFor(m => m.MEMBER_PACKAGE.PACKAGE_NAME, new { @id = "cPACKAGE_NAME", @name = "PACKAGE_NAME", @class = "form-control m-input", @disabled = "disabled", @style = "display: ;" })
                                </div>
                            </div>
                            <div class="form-group m-form__group row">
                                <label for="message-text" class="col-4 col-form-label">Package Detail:</label>
                                <div class="col-8">
                                    @Html.TextBoxFor(m => m.MEMBER_PACKAGE.PACKAGE_DETAIL, new { @id = "cPACKAGE_DETAIL", @name = "PACKAGE_DETAIL", @class = "form-control m-input", @disabled = "disabled", @style = "display: ;" })
                                </div>
                            </div>

                            <div class="form-group m-form__group row">
                                <label for="message-text" class="col-4 col-form-label">Price:</label>
                                <div class="col-8">
                                    @Html.TextBoxFor(m => m.MEMBER_PACKAGE.PRICE, new { @id = "cPRICE", @name = "PRICE", @class = "form-control m-input", @disabled = "disabled", @style = "display: ;" })
                                </div>
                            </div>
                            <div class="form-group m-form__group row">
                                <label for="message-text" class="col-4 col-form-label">Slip โอนเงิน</label>
                                <div class="col-8">
                                   
                                        <img src="~/Content/images/course/BlankBanner.png" id="imgSlip" class="img-thumbnail imgZoom"
                                             style=" width:100%;margin-top:15px" />
                                   
                                    
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn m-btn--pill m-btn--air         btn-outline-primary active">Approve</button>
                        <button type="button" class="btn m-btn--pill m-btn--air         btn-outline-metal active" data-dismiss="modal">Reject</button>
                    </div>

                </div>
            </div>
        </div>
    }
    <!--end::Modal-->

    <script>

        function ConfirmPurchase(id) {
            var tmpData = @Html.Raw(Json.Encode(Model.LIST_MEMBER_PACKAGE));
            for (var i = 0; i < tmpData.length; i++) {
                if (tmpData[i].AUTO_ID == id) {
                    $('#cAUTO_ID').val(id);
                    $('#cPACKAGE_NAME').val(tmpData[i].PACKAGE_NAME);
                    $('#cPACKAGE_DETAIL').val(tmpData[i].PACKAGE_DETAIL);
                    $('#cPRICE').val(tmpData[i].PRICE);
                    $('#cEFFECTIVE_DATE').val(tmpData[i].EFFECTIVE_DATE);
                    $("#imgSlip").attr("src","../"+ tmpData[i].SLIP_URL1);
                    $('#m_modal_5').modal('show');
                }
            }
         
        }
    </script>
</div>
